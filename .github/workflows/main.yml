name: Trigger Game Design Ingress

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  ingress-job:
    runs-on: ubuntu-latest
    # This line is critical! It connects the job to your new 'env' environment
    environment: env
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Trigger plan ingress
        env:
          # Use 'vars' because they are Environment Variables, not Secrets
          MCP_ENDPOINT: ${{ vars.MCP_ENDPOINT }}
          MCP_TOKEN: ${{ vars.MCP_TOKEN }}
        run: |
          PLAN_ID="daily-game-design-run"
          
          echo "Connecting to endpoint: $MCP_ENDPOINT"
          
          if [ -z "$MCP_ENDPOINT" ]; then
            echo "Error: MCP_ENDPOINT is empty. Check your Environment Variables."
            exit 1
          fi

          curl -X POST "$MCP_ENDPOINT/ingress" \
            -H "Authorization: Bearer $MCP_TOKEN" \
            -H "Content-Type: application/json" \
            -d "{\"plan_id\": \"$PLAN_ID\"}"
